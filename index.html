<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link href="styles.css" rel="stylesheet" />
  </head>
  <body>

    <p><a class="show-new-tweets hide" href="#">Show <span class="new-tweet-counter"></span> new tweets</a></p>

    <div class="feed"></div>


    <script>

      $(document).ready(function(){
        var $body = $('body');
        var $feedDiv = $('.feed');
        //$body.html('');

        var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $('<div></div>');
          $tweet.text('@' + tweet.user + ': ' + tweet.message);
          $tweet.prependTo($feedDiv);
          index -= 1;
        }


        // Init
        var numTweetsDisplayed = streams.home.length;

        // update counter that shows number of tweets not displayed yet
        var updateNewTweetCounter = function(numNewTweets) {
          if ($('.show-new-tweets').hasClass('hide')) {
            $('.show-new-tweets').removeClass('hide');
            $('.show-new-tweets').on('click', showNewTweets);
          }

          $('.new-tweet-counter').text(numNewTweets);
        }

        // checks if there are any new tweets that aren't displayed yet
        var checkForNewTweets = function() {
          var numNewTweets = streams.home.length - numTweetsDisplayed;

          // if there are new tweets...
          if (numNewTweets > 0) {
            /// update the counter
            updateNewTweetCounter(numNewTweets);
          }
        }

        // show new tweets
        var showNewTweets = function() {
          // determine how many tweets are hidden
          var streamLen = streams.home.length;
          var numNewTweets = streamLen - numTweetsDisplayed;

          // loop through hidden tweets...
          for (var i = numTweetsDisplayed; i < streamLen; i++) {
            // display tweet at the top of the feed
            var tweet = streams.home[i];
            var $tweet = $('<div></div>');
            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $tweet.prependTo($feedDiv);
          }
          // update global var
          numTweetsDisplayed += numNewTweets;

          // hide "show new tweets" link
          $('.show-new-tweets').addClass('hide');
        }

        // auto-check
        setInterval(function() {
          checkForNewTweets();
        });

      });


    </script>

  </body>
</html>
