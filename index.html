<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link href="styles.css" rel="stylesheet" />
  </head>
  <body>

    <p><a class="show-new-tweets hide" href="#">Show <span class="new-tweet-counter"></span> new tweets</a></p>

    <div class="feed"></div>


    <script>

      $(document).ready(function(){
        var $body = $('body');
        var $feedDiv = $('.feed');
        var feed = streams.home;
        var numTweetsDisplayed = streams.home.length;


        // format tweet and add to feed
        var addToFeed = function(tweet) {
          var $tweetDiv = $('<div class="tweet"></div>');
          $tweetDiv.append(
            '<p><a class="link-username" href="#">@' + tweet.user + '</a></p>' +
            '<p>' + tweet.message + '</p>' +
            '<p>' + tweet.created_at + '</p>'
          );
          $tweetDiv.prependTo($feedDiv);
          $tweetDiv.find('.link-username').on('click', function() {
            feed = streams.users[tweet.user];
            renderFeed();
          });
        };

        // update counter that shows number of tweets not displayed yet
        var updateNewTweetCounter = function(numNewTweets) {
          if ($('.show-new-tweets').hasClass('hide')) {
            $('.show-new-tweets').removeClass('hide');
            $('.show-new-tweets').on('click', showNewTweets);
          }

          $('.new-tweet-counter').text(numNewTweets);
        };

        // check if there are any new tweets that aren't displayed yet
        var checkForNewTweets = function() {
          var numNewTweets = feed.length - numTweetsDisplayed;

          // if there are new tweets...
          if (numNewTweets > 0) {
            /// update the counter
            updateNewTweetCounter(numNewTweets);
          }
        };

        // show new tweets
        var showNewTweets = function() {
          // determine how many tweets are hidden
          var streamLen = feed.length;
          var numNewTweets = streamLen - numTweetsDisplayed;

          // loop through hidden tweets...
          for (var i = numTweetsDisplayed; i < streamLen; i++) {
            // display tweet at the top of the feed
            var tweet = feed[i];
            addToFeed(tweet);
          }
          // update global var
          numTweetsDisplayed += numNewTweets;

          // hide "show new tweets" link
          $('.show-new-tweets').addClass('hide');
        };


        // render home or user feed
        var renderFeed = function() {
          // clear feed div
          $feedDiv.html('');

          var index = feed.length - 1;

          while(index >= 0){
            var tweet = feed[index];
            addToFeed(tweet);
            index -= 1;
          };
        };

        // Initial feed render (home)
        renderFeed();

        // auto-check for new tweets
        setInterval(function() {
          checkForNewTweets();
        });

      });


    </script>

  </body>
</html>
